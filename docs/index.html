<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Surveillance Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      max-width: 960px;
      margin: auto;
    }
    #calendar {
      margin-top: 2rem;
    }
    #indicatorSummary {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>Stock Surveillance Dashboard</h1>

  <label for="fileSelector">Select JSON file:</label>
  <select id="fileSelector">
    <option value="IND010125.json">IND010125.json</option>
    <option value="IND020125.json">IND020125.json</option>
    <!-- Add more file options here manually -->
  </select>

  <div id="calendar"></div>
  <div id="indicatorSummary"></div>

  <script>
    async function fetchStockData(fileName) {
      const response = await fetch(`../data_json/${fileName}`);
      if (!response.ok) {
        alert("Failed to load file: " + fileName);
        return [];
      }
      return await response.json();
    }

    function extractIndicators(data) {
      return data.map(entry => ({
        symbol: entry.SYMBOL,
        date: entry.DATE,
        indicators: {
          regFlag: entry.REG_FLAG,
          asmStage: entry.ASM_STAGE,
          gsmStage: entry.GSM_STAGE || null,
        }
      }));
    }

    function groupByDate(data) {
      const summary = {};
      data.forEach(entry => {
        const date = entry.date;
        if (!summary[date]) {
          summary[date] = {
            regCount: 0,
            asm1Count: 0,
            asm2Count: 0,
            total: 0,
          };
        }
        if (entry.indicators.regFlag === '1') summary[date].regCount += 1;
        if (entry.indicators.asmStage === '1') summary[date].asm1Count += 1;
        if (entry.indicators.asmStage === '2') summary[date].asm2Count += 1;
        summary[date].total += 1;
      });
      return summary;
    }

    function convertToCalendarEvents(summary) {
      return Object.entries(summary).map(([date, stats]) => ({
        title: `REG: ${stats.regCount}, ASM1: ${stats.asm1Count}, ASM2: ${stats.asm2Count}`,
        date,
        allDay: true
      }));
    }

    function displaySummary(summary) {
      const container = document.getElementById('indicatorSummary');
      container.innerHTML = '<h3>Daily Summary</h3>';
      Object.entries(summary).forEach(([date, stats]) => {
        const div = document.createElement('div');
        div.textContent = `${date}: REG=${stats.regCount}, ASM1=${stats.asm1Count}, ASM2=${stats.asm2Count}`;
        container.appendChild(div);
      });
    }

    function renderCalendar(events) {
      document.getElementById('calendar').innerHTML = '';
      const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        events: events
      });
      calendar.render();
    }

    document.getElementById('fileSelector').addEventListener('change', async function () {
      const file = this.value;
      const rawData = await fetchStockData(file);
      const indicators = extractIndicators(rawData);
      const summary = groupByDate(indicators);
      const events = convertToCalendarEvents(summary);

      renderCalendar(events);
      displaySummary(summary);
    });

    // Auto-load first file on page load
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('fileSelector').dispatchEvent(new Event('change'));
    });
  </script>
</body>
</html>



